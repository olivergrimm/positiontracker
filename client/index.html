<!DOCTYPE html>
<html>
<head>
  <title>vtt-jura-ete-2025</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }

  .gpx-label {
    font-size: 10px;
    color: black;
    background-color: white;
    padding: 2px 4px;
    border-radius: 4px;
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
    white-space: nowrap;
    pointer-events: none;
  }
</style>

  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/2.1.2/gpx.min.js" defer></script>



<script>
  const map = L.map('map').setView([47.3769, 8.5417], 10); // Beispiel: Zürich

  const swisstopo = L.tileLayer(
    "https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg",
    {
      attribution: '© <a href="https://www.swisstopo.admin.ch/">swisstopo</a>',
      maxZoom: 18,
      tileSize: 256,
    }
  );

  swisstopo.addTo(map);

  const kml1 = omnivore.kml('../assets/genf-lepont.kml').addTo(map);
  const kml2 = omnivore.kml('../assets/lepont-saignelegier.kml').addTo(map);
  const kml3 = omnivore.kml('../assets/saignelegier-rombach.kml').addTo(map);
  const kml4 = omnivore.kml('../assets/etappenorte.kml').addTo(map);

  const group = L.featureGroup([kml1, kml2, kml3]);
  kml3.on('ready', () => {
    map.fitBounds(group.getBounds());
  });

  document.addEventListener('DOMContentLoaded', function () {

    // GPX-Track laden und anzeigen
    const gpxTrack = new L.GPX('https://gpx-tracker-production.up.railway.app/track.gpx', {
      async: true,
      polyline_options: {
        color: 'red',
        weight: 4,
        opacity: 0.75,
      }
    })
      .on('loaded', function (e) {
        map.fitBounds(e.target.getBounds());
      })
      .addTo(map);

    // Zusätzlich: Zeitpunkte aus GPX extrahieren und als Label anzeigen
    fetch('https://gpx-tracker-production.up.railway.app/track.gpx')
      .then(response => response.text())
      .then(gpxText => {
        const parser = new DOMParser();
        const gpxDoc = parser.parseFromString(gpxText, "application/xml");
        const trkpts = gpxDoc.getElementsByTagName("trkpt");

        for (let i = 0; i < trkpts.length; i++) {
          const pt = trkpts[i];
          const lat = parseFloat(pt.getAttribute("lat"));
          const lon = parseFloat(pt.getAttribute("lon"));
          const timeEl = pt.getElementsByTagName("time")[0];
          const time = timeEl ? new Date(timeEl.textContent).toLocaleTimeString()  : "Keine Zeit";

        L.circleMarker([lat, lon], {
          radius: 50,
          color: 'red',
          fillColor: 'red',
          fillOpacity: 1
        }).addTo(map);

        // Zeit-Label separat
        L.marker([lat, lon], {
          icon: L.divIcon({
            className: 'gpx-label',
            html: `<div class="gpx-label-text">${time}</div>`,
            iconSize: [60, 20],
            iconAnchor: [30, 10]
          })
        }).addTo(map);

        }
      });
  });
</script>


</body>
</html>


